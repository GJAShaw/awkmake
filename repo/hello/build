== ------------------------------------------------------------------
== file: build
== type: TACL for Guardian software build using GNU Make
== project: awkmake
== ------------------------------------------------------------------


?SECTION define_everything MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

define_flags
define_texts
define_diskfiles_repository_source
define_diskfiles_other
define_spooler_locations
define_defines
define_assigns
define_params
define_gs100obj_hello_rule
define_gs100exe_hello_rule


?SECTION define_flags MACRO
== ------------------------------------------------------------------
== Reserved for future use
== ------------------------------------------------------------------

[#DEF :flags STRUCT
  BEGIN
    BOOL false VALUE 0;
    BOOL true  VALUE -1;
  END;
]


?SECTION define_texts MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :tal_directives TEXT |BODY|OPTIMIZE 0] == Let OCAX optimize


?SECTION define_diskfiles_repository_source MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :repo STRUCT
  BEGIN
    STRUCT hello;
      BEGIN
        SUBVOL tmp VALUE $STAT.GSHELTMP;
        FNAME build    VALUE $STAT.GSHELLO.BUILD;
      END;
    STRUCT gstalsrc;
      BEGIN
        SUBVOL tmp VALUE $STAT.GSTALTMP;
        FNAME hello    VALUE $STAT.GSTALSRC.HELLO;
      END;
  END;
]


?SECTION define_diskfiles_other MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :targets STRUCT
  BEGIN
    STRUCT gs100obj;
      BEGIN
        FNAME hello    VALUE $STAT.GS100OBJ.HELLO;
      END;
    STRUCT gs100exe;
      BEGIN
        FNAME hello    VALUE $STAT.GS100EXE.HELLO;
      END;
  END;
]

[#DEF :system STRUCT == system disk
  BEGIN
    STRUCT system;
      BEGIN
        FNAME ctoedit  VALUE $SYSTEM.SYSTEM.CTOEDIT;
        FNAME extdecs1 VALUE $SYSTEM.SYSTEM.EXTDECS1;
        FNAME ocax     VALUE $SYSTEM.SYSTEM.OCAX;
        FNAME tal      VALUE $SYSTEM.SYSTEM.TAL;
      END;
    STRUCT zsysdefs;
      BEGIN
        FNAME zsystal  VALUE $SYSTEM.ZSYSDEFS.ZSYSTAL;
      END;
  END;
]


?SECTION define_spooler_locations MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :spooler STRUCT
  BEGIN
    STRUCT gstalsrc;
      BEGIN
        FNAME hello VALUE $S.#HELLO.CTOEDIT;
      END;
    STRUCT gs100obj;
      BEGIN
        FNAME hello VALUE $S.#HELLO.TAL;
      END;
    STRUCT gs100exe;
      BEGIN
        FNAME hello VALUE $S.#HELLO.OCAX;
      END;
  END;
]


?SECTION define_defines MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

DELETE DEFINE =EXTDECS1
ADD DEFINE    =EXTDECS1, CLASS MAP, FILE [:system:system:extdecs1]
DELETE DEFINE =ZSYSTAL
ADD DEFINE    =ZSYSTAL, CLASS MAP, FILE [:system:zsysdefs:zsystal]


?SECTION define_assigns MACRO
== ------------------------------------------------------------------
== Reserved for future use
== ------------------------------------------------------------------

ASSIGN WHATEVS, [:repo:gstalsrc:hello]


?SECTION define_params MACRO
== ------------------------------------------------------------------
== Reserved for future use
== ------------------------------------------------------------------

PARAM SUMMAT [:flags:something_or_other]


?SECTION define_gs100obj_hello_rule MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :gs100obj_hello_dependencies TEXT |BODY|
  $(b24s1_gs100obj_hello): $(b24s1_gstalsrc_hello)
  $(system_system_tal)
]

[#DEF :gs100obj_hello_recipe MACRO |BODY|
  RUN [:system:system:tal]/IN [:repo:gstalsrc:hello], &
    OUT [:spooler:gs100obj:hello], TERM $ZHOME/ &
    [:repo:gs100obj:hello]; [:tal_directives]
]


?SECTION define_gs100exe_hello_rule MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :gs100exe_hello_dependencies TEXT |BODY|
  $(b24s1_gs100exe_hello): $(b24s1_gs100obj_hello)
  $(system_system_ocax)
]

[#DEF :gs100exe_hello_recipe MACRO |BODY|
  RUN [:system:system:ocax]/OUT [:spooler:gs100exe:hello], &
    TERM $ZHOME/ [:repo:gs100obj:hello] &
    output_file [:repo:gs100exe:hello]
]


== ------------------------------------------------------------------
== EOF
== ------------------------------------------------------------------

