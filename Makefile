# ------------------------------------------------------------------------------
# file: Makefile
# type: GNU makefile
# project: awkmake
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# variables
# ------------------------------------------------------------------------------

build_tacl := ./build.tacl
rules_mk := ./rules.mk
variables_mk := ./variables.mk

targets :=
targets += \
  $(rules_mk) \
  $(variables_mk)
  
scripts_dir := ./scripts
printRules_awk := $(scripts_dir)/printRules.awk
printVariables_awk := $(scripts_dir)/printVariables.awk

RM := rm -fR

# ------------------------------------------------------------------------------
# rules
# ------------------------------------------------------------------------------

# --------------------------------------
# all
# --------------------------------------
all: $(targets)

# --------------------------------------
# .ONESHELL
# --------------------------------------
.ONESHELL:

# --------------------------------------
# .PHONY
# --------------------------------------
.PHONY: .ONESHELL all clean

# --------------------------------------
# rules_mk
# --------------------------------------
$(rules_mk): $(build_tacl) $(printRules_awk)
	@echo "Building $@"
	@$(printRules_awk) < $(build_tacl) > "$@" 2> /dev/null

# --------------------------------------
# variables_mk
# --------------------------------------
$(variables_mk): $(build_tacl) $(printVariables_awk)
	@echo "Building $@"
	@$(printVariables_awk) < $(build_tacl) > "$@" 2> /dev/null

# --------------------------------------
# 
# --------------------------------------


# --------------------------------------
# clean
# --------------------------------------
clean:
	@echo "Deleting all targets and intermediate files"
	-@$(RM) $(targets)

# ------------------------------------------------------------------------------
# EOF
# ------------------------------------------------------------------------------
