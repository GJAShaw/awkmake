== ------------------------------------------------------------------
== file: build
== type: TACL for Guardian software build using GNU Make
== project: awkmake
== ------------------------------------------------------------------


?SECTION define_everything MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

define_flags
define_diskfiles
define_spooler_locations
define_defines
define_assigns
define_params
define_make_rules


?SECTION define_flags MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

[#DEF :flags STRUCT
  BEGIN
    BOOL :something_or_other VALUE 0;
  END;
]


?SECTION define_diskfiles MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

==
== b24s1 - a copy of the secure repository disk
==
[#DEF :b24s1 STRUCT
  BEGIN
    STRUCT hello;
      BEGIN
        SUBVOL tmp VALUE $DEV1.GSHELTMP;
        FNAME build    VALUE $DEV1.GSHELLO.BUILD;
      END;
    STRUCT gstalsrc;
      BEGIN
        SUBVOL tmp VALUE $DEV1.GSTALTMP;
        FNAME hello    VALUE $DEV1.GSTALSRC.HELLO;
      END;
  END;
]

==
== system - the system disk
==
[#DEF :system STRUCT
  BEGIN
    STRUCT system; == subvolume name
      BEGIN
        SUBVOL tmp VALUE $DEV1.GSSYSTMP;
        FNAME ctoedit  VALUE $SYSTEM.SYSTEM.CTOEDIT;
        FNAME ocax     VALUE $SYSTEM.SYSTEM.OCAX;
        FNAME tal      VALUE $SYSTEM.SYSTEM.TAL;
      END;
  END;
]


?SECTION define_spooler_locations MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------
[#DEF :spooler STRUCT
  BEGIN
    FNAME hello_ocax VALUE $S.#HELLO.OCAX;
    FNAME hello_tal  VALUE $S.#HELLO.TAL;
  END;
]


?SECTION define_defines MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------
DELETE DEFINE =gstalsrc_hello
ADD DEFINE    =gstalsrc_hello, [:b24s1:gstalsrc:hello]


?SECTION define_assigns MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------
ASSIGN WHATEVS, [:b24s1:gstalsrc:hello]


?SECTION define_params MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------
PARAM SUMMAT, [:flags:something_or_other]


?SECTION define_make_rules MACRO
== ------------------------------------------------------------------
== Comments go here
== ------------------------------------------------------------------

== gs100obj_hello
[#DEF :gs100obj_hello_dependencies TEXT |BODY|
  $(gs100obj_hello): $(gstalsrc_hello)
  $(_tal)
]
[#DEF :gs100obj_hello_recipe MACRO |BODY|
  RUN =_tal/IN =gstalsrc_hello, OUT =gs100obj_hello_log, TERM $ZHOME/ &
    =gs100obj_hello; [:tal_directives]
]

== gs100obj_exe
[#DEF :gs100exe_hello_dependencies TEXT |BODY|
  $(gs100exe_hello): $(gs100obj_hello)
  $(_ocax)
]
[#DEF :gs100exe_hello_recipe MACRO |BODY|
  RUN =_ocax/OUT =gs100exe_hello_log, TERM $ZHOME/ =gs100obj_hello &
    output_file =gs100exe_hello
]

== commented_out target, for unit testing
==[#DEF :commented_out_dependencies TEXT |BODY|
==  $(commented_out): $(commented_out_deps)
==]
==[#DEF :commented_out_recipe MACRO |BODY|
==  RUN =_ocax/OUT =ocax_out, TERM $ZHOME/ =gs100obj_hello &
==    -output_file =gs100exe_hello
==]

== ------------------------------------------------------------------
== EOF
== ------------------------------------------------------------------

